<mat-card class="mat-card p-3" appearance="outlined">
  <mat-card-header
    style="
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: -25px;
    "
  >
    <mat-card-title style="width: 400px; display: flex; align-items: center">
      Suivis des Transport
    </mat-card-title>

    <!-- Filter Button -->
    <div class="search-container">
      <button mat-icon-button color="black" (click)="refresh()">
        <mat-icon>refresh</mat-icon>
      </button>

      <button mat-icon-button color="black" (click)="add()">
        <mat-icon>add</mat-icon>
      </button>

      <button mat-icon-button color="black" [matMenuTriggerFor]="menuExport">
        <mat-icon>upload_file</mat-icon>
      </button>
      <mat-menu #menuExport="matMenu">
        <button mat-menu-item (click)="exportToExcel2()">
          <span>Par axe</span>
        </button>
        <button mat-menu-item (click)="exportToExcel()">
          <span>Excel</span>
        </button>
      </mat-menu>

      <button
        mat-icon-button
        color="black"
        [matMenuTriggerFor]="menu"
        style="margin-right: 15px"
        (click)="loadfilterdata()"
      >
        <mat-icon>filter_alt</mat-icon>
      </button>

      <mat-menu #menu="matMenu" class="p-2">
        <mat-form-field
          appearance="outline"
          (click)="$event.stopPropagation()"
          style="width: 100%"
        >
          <mat-label>Enter a date range</mat-label>
          <mat-date-range-input [rangePicker]="picker">
            <!-- Binding startDate and endDate separately -->
            <input
              matStartDate
              placeholder="Start date"
              [(ngModel)]="startDate"
            />
            <input matEndDate placeholder="End date" [(ngModel)]="endDate" />
          </mat-date-range-input>
          <mat-hint>MM/DD/YYYY – MM/DD/YYYY</mat-hint>
          <mat-datepicker-toggle
            matIconSuffix
            [for]="picker"
          ></mat-datepicker-toggle>
          <mat-date-range-picker #picker></mat-date-range-picker>
        </mat-form-field>

        <mat-form-field
          appearance="outline"
          (click)="$event.stopPropagation()"
          style="width: 100%"
        >
          <mat-label>Heure transport</mat-label>
          <mat-select [(ngModel)]="selectedHeure">
            <mat-option *ngFor="let heure of Listheure" [value]="heure">
              {{ heure.heuretransport_heure }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field
          appearance="outline"
          (click)="$event.stopPropagation()"
          style="width: 100%"
        >
          <mat-label>Axe</mat-label>
          <mat-select [(ngModel)]="selectedAxe">
            <mat-option *ngFor="let axe of Listaxe" [value]="axe">
              {{ axe.axe_libelle }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <button
          mat-flat-button
          style="background-color: black"
          (click)="onValider()"
        >
          Valider
        </button>
      </mat-menu>
    </div>

    <!-- Search Field -->
    <div style="margin-top: 25px">
      <mat-form-field appearance="outline">
        <mat-label>Recherche</mat-label>
        <input matInput (keyup)="applyFilter($event)" placeholder="Recherche" />
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
    </div>
  </mat-card-header>

  <!-- Table Container -->
  <div class="mat-card-content">
    <!-- Material Table -->
    <table
      *ngIf="!isLoading"
      mat-table
      [dataSource]="dataSource"
      class="mat-table"
      appearance="outlined"
    >
      <!-- Date Column -->
      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef>Date</th>
        <td mat-cell *matCellDef="let element" class="{{ element.color }}">
          {{ element.date }}
        </td>
      </ng-container>

      <!-- Nom Column -->
      <ng-container matColumnDef="nom">
        <th mat-header-cell *matHeaderCellDef>Nom</th>
        <td mat-cell *matCellDef="let element" class="{{ element.color }}">
          <span>{{ element.usr_prenom }}</span>
        </td>
      </ng-container>

      <!-- HS Planifié Column -->
      <ng-container matColumnDef="hsPlanifie">
        <th mat-header-cell *matHeaderCellDef>HS Planifié</th>
        <td mat-cell *matCellDef="let element" class="{{ element.color }}">
          {{ element.planning_sortie }}
        </td>
      </ng-container>

      <!-- Heure Column -->
      <ng-container matColumnDef="heure">
        <th mat-header-cell *matHeaderCellDef>Heure</th>
        <td mat-cell *matCellDef="let element" class="{{ element.color }}">
          {{ element.heuretransport_heure }}
        </td>
      </ng-container>

      <!-- Axe Column -->
      <ng-container matColumnDef="axe">
        <th mat-header-cell *matHeaderCellDef>Axe</th>
        <td mat-cell *matCellDef="let element" class="{{ element.color }}">
          {{ element.axe_libelle }}
        </td>
      </ng-container>

      <!-- Quartie Column -->
      <ng-container matColumnDef="quartie">
        <th mat-header-cell *matHeaderCellDef>Quartie</th>
        <td mat-cell *matCellDef="let element" class="{{ element.color }}">
          {{ element.transportuser_quartier }}
        </td>
      </ng-container>

      <!-- Site Column -->
      <ng-container matColumnDef="site">
        <th mat-header-cell *matHeaderCellDef>Site</th>
        <td mat-cell *matCellDef="let element" class="{{ element.color }}">
          {{ element.site_libelle }}
        </td>
      </ng-container>

      <!-- Service Column -->
      <ng-container matColumnDef="service">
        <th mat-header-cell *matHeaderCellDef>Service</th>
        <td mat-cell *matCellDef="let element" class="{{ element.color }}">
          {{ element.campagnes_et_services }}
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let element" style="width: 150px">
          <button
            mat-icon-button
            (click)="edit(element)"
            [ngStyle]="{
              color: element.transportuser_id === null ? '#8080806b' : '#00447c'
            }"
            [disabled]="element.transportuser_id === null"
          >
            <mat-icon>edit</mat-icon>
          </button>
          <button
            mat-icon-button
            color="warn"
            (click)="openConfirmationDialog(element)"
            style="color: #db2a48"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <!-- Table Header and Rows -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <div *ngIf="isLoading" class="overlay">
      <mat-spinner class="orange-spinner"></mat-spinner>
    </div>

    <!-- Pagination -->
    <mat-paginator
      [length]="data.length"
      [pageSize]="5"
      [pageSizeOptions]="[5, 10, 25, 100]"
      (page)="dataSource.paginator = paginator"
    >
    </mat-paginator>
  </div>
</mat-card>
